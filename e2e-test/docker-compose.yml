services:
  runtime:
    build: ./docker
    volumes:
      - '../:/src'
      - './docker/run.sh:/home/docker/run.sh'
      - './scripts:/home/docker/scripts'
    ports:
      - 7681:7681
    command: ['./run.sh']

  playwright:
    depends_on:
      runtime:
        condition: service_healthy
    image: mcr.microsoft.com/playwright:v1.39.0-jammy@sha256:dccb9c6518090a100aaa820ff0b1d0c7ec12154f80696e7799b5cd9232daa0b0
    user: pwuser
    security_opt:
      - 'seccomp=./docker/playwright_seccomp_profile.json'
    ipc: host # Recommended when running chrome
    init: true
    environment:
      BASE_URL: 'http://runtime:7681'
      DOCKER: true
      NPM_CONFIG_UPDATE_NOTIFIER: 0 # Suppress npm new version message, since it's out of our control
    volumes:
      - './:/src'
    ports:
      - 9323:9323
    working_dir: /src
    command: tail -f /dev/null
